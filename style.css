/* ========== ベース ========== */
*{box-sizing:border-box}
html,body{height:100%}
html{ -webkit-text-size-adjust:100% }
body{
  margin:0;background:#000;color:#e9e9e9;
  font-family:"ten-mincho", "Yu Mincho", "Hiragino Mincho ProN", serif; /* 貂明朝（読み込み済み想定） */
  -webkit-font-smoothing:antialiased;
}

/* ウィンドウ外＝貂明朝 / ウィンドウ内＝秀英角ゴシック金 */
.ui-serif{font-family:"ten-mincho","Yu Mincho","Hiragino Mincho ProN",serif}
.gothic{font-family:"dnp-shuei-gothic-kin-std","Yu Gothic","Hiragino Kaku Gothic ProN",Meiryo,sans-serif}

/* スクリーン共通（全画面） */
.screen{
  min-height:100vh; width:100%;
  position:relative; display:none; padding:0 6%;
}
.screen.active{ display:flex }
.center-stack{ justify-content:center; align-items:center; text-align:center }
.scroll-page{ overflow:auto } /* この画面だけページ自体がスクロール可能 */

/* ページ全体スクロール抑制（基本） */
html, body { overflow:hidden }

/* オーバーレイ（スキャンライン＆グレイン） */
#overlay{position:fixed;inset:0;pointer-events:none;z-index:8}
#overlay .scanlines{
  position:absolute;inset:0;
  background:repeating-linear-gradient(to bottom, rgba(255,255,255,.06) 0 1px, transparent 1px 3px);
  mix-blend-mode:overlay; opacity:.25;
}
#overlay .grain{
  position:absolute;inset:0;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.05), rgba(0,0,0,0) 40%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.04), rgba(0,0,0,0) 45%),
    repeating-conic-gradient(from 0deg, rgba(255,255,255,.06) 0 .5deg, rgba(0,0,0,0) .5deg 1deg);
  animation:grainShift 1.2s steps(2) infinite;
  opacity:.18;
}
@keyframes grainShift{
  0%{transform:translate(0,0)}50%{transform:translate(-1px,1px)}100%{transform:translate(0,0)}
}

/* ノイズ映像（上から薄く被せる） */
.v-noise{
  position:fixed; inset:0; width:100%; height:100%; object-fit:cover;
  opacity:.18; mix-blend-mode:screen; pointer-events:none; z-index:7; display:none;
}
#screen-story.active ~ #v-noise-story{ display:block }
#screen-records.active ~ #v-noise-records{ display:block }

/* タイトル、文面 */
.spaced{ letter-spacing:.22em; line-height:1.9 }
.percent{ margin-top:.6rem; color:#777 }
.who-line{ color:#bdbdbd; letter-spacing:.18em; margin:.2rem 0 .8rem; font-size:clamp(12px,3.6vw,14px) }
.kaiki{
  color:#9b0b0b; text-shadow:0 0 10px rgba(139,0,0,.35);
  font-size:clamp(22px,8.2vw,40px); letter-spacing:.08em; margin:.2rem 0 0;
}
.glow-break span{ display:inline-block; }
.glow-break{ filter:drop-shadow(0 0 6px rgba(255,255,255,.06)); }
.kaiki-sub{ margin:.2rem 0 10px; color:#8b0000; letter-spacing:.12em; font-size:1rem }
.chrom a{}
.nowrap{ white-space:nowrap }

/* パネル（新デザイン） */
.panel.win{
  background:linear-gradient(180deg, #141414 0%, #0e0e0e 100%);
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px; overflow:hidden; color:#eaeaea;
  box-shadow: 0 20px 60px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.05);
}
.panel-head{
  display:flex; justify-content:space-between; align-items:center;
  background:linear-gradient(180deg,#1e1e1e 0%,#131313 100%);
  padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06);
  font-family:"dnp-shuei-gothic-kin-std",sans-serif; letter-spacing:.2em;
}
.panel-title{ font-weight:700; font-size:.95rem }
.panel-ctrl .dot{ display:inline-block; width:8px; height:8px; border-radius:50%; margin-left:6px; background:#3a3a3a }
.panel-body{ padding:14px }

/* サイズ */
.win.small{ width:min(480px,100%); margin-left:auto }
.win.medium{ width:min(640px,100%) }
.win.large{ width:min(900px,100%) }

/* アニメ（出現） */
.slide-up{ animation:slideUp .55s cubic-bezier(.2,.8,.2,1) both }
@keyframes slideUp{ from{transform:translateY(20px); opacity:0} to{transform:none; opacity:1} }
.fade-in-delay{ animation:fadeIn .6s ease .2s both }
.fade-in-later{ animation:fadeIn .6s ease 1.8s both }
@keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }

/* スクロールボックス（縦のみ） */
.scrollbox{
  max-height:55vh; overflow-y:auto; overflow-x:hidden;
  padding:12px; background:#0a0a0a; color:#e9e9e9;
  border:1px solid rgba(255,255,255,.08); border-radius:6px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
.scrollbox::-webkit-scrollbar{ width:10px }
.scrollbox::-webkit-scrollbar-track{ background:#141414 }
.scrollbox::-webkit-scrollbar-thumb{ background:#2b2b2b; border-radius:6px }

/* 文章（にじみ・掠れは後述のクラスで付与） */
.story-text{ line-height:1.82; letter-spacing:.01em; font-size:clamp(14px,3.6vw,17px) }
.story-text p{ margin:0 0 1.1em 0 }

/* ジッター＆ブラー／にじみ */
.jitter{ position:relative; display:inline-block; animation:jitter .7s infinite steps(2); }
@keyframes jitter{ 0%{transform:translate(0,0)}50%{transform:translate(.5px,-.6px)}100%{transform:translate(0,0)} }
.blurword{ filter:blur(.35px); text-shadow:0 0 1px rgba(255,255,255,.08), 0 0 6px rgba(255,255,255,.05) }
.smeary{ text-shadow: 0 .5px .5px rgba(255,255,255,.15), 0 0 6px rgba(255,255,255,.04) }

/* 受付フォーム */
.entry-form{ display:flex; gap:10px; align-items:center; margin:.6rem 0 .4rem }
#nick-input{
  width:100%; max-width:420px; padding:.62rem .7rem; background:#0b0b0b; color:#e9e9e9;
  border:1px solid rgba(255,255,255,.15); border-radius:6px;
}
#nick-input:focus{ outline:none; border-color:#8b0000; box-shadow:0 0 0 3px rgba(139,0,0,.25) }
.note-strong{ font-weight:600 }
.foot-mini{ color:#888; font-size:.82rem }

/* ボタン */
.btn{
  background:#1a1a1a; color:#e9e9e9; border:1px solid rgba(255,255,255,.18);
  border-radius:6px; padding:.6rem 1rem; cursor:pointer;
  transition:transform .09s ease, filter .2s ease, background .2s ease;
}
.btn:hover{ filter:brightness(1.08) }
.btn:active{ transform:translateY(1px) scale(.99); background:#111 }

/* 注意書き */
.warning{ color:#8b0000; font-weight:700; line-height:2; }
.center-keep{ text-align:center }
.caution-mini{ color:#9a3a3a; font-size:.82rem; margin:.5rem 0 0 }

/* 結果の光り（グリッチ時のブラー） */
.glow-burst{ animation:glowBurst .6s ease both }
@keyframes glowBurst{ from{filter:blur(2px) brightness(1.1)} to{filter:none} }

/* 受信ログ（絶対に見るな） */
.help-chant{ color:#a80c0c; font-weight:700; letter-spacing:-.02em; opacity:0; transition:opacity .25s }
.help-chant.show{ opacity:1 }

/* カルテ */
.records{ width:100%; max-width:900px; margin:40px auto; }
.records-title{ text-align:center; color:#a00; letter-spacing:.12em; margin:0 0 10px }
.card{ background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.08); border-radius:8px; padding:12px; margin:12px 0 }
.karte{ width:100%; border-collapse:collapse; table-layout:fixed }
.karte th,.karte td{ padding:8px; border-bottom:1px dashed rgba(255,255,255,.08); vertical-align:top; word-break:break-word }
.karte th{ white-space:nowrap; width:30% }

/* モザイク（斜めしま） */
.mosaic{ position:relative; display:inline-block; color:transparent; padding:0 .25em; border-radius:2px; outline:1px solid rgba(255,255,255,.12) }
.mosaic::after{
  content:""; position:absolute; inset:0; border-radius:2px;
  background:repeating-linear-gradient(135deg,rgba(20,20,20,1) 0 6px, rgba(0,0,0,.78) 6px 12px),
             linear-gradient(to bottom,rgba(255,255,255,.05), rgba(0,0,0,0));
  opacity:.96; animation:mosaicPulse 3s ease-in-out infinite;
}
@keyframes mosaicPulse { 0%,100%{opacity:.96} 50%{opacity:.86} }

/* 自動更新のきらめき */
.card.updated{ animation:updateBlink 1.2s ease 1 }
@keyframes updateBlink{ 0%{box-shadow:0 0 0 rgba(139,0,0,0)} 20%{box-shadow:0 0 24px rgba(139,0,0,.35)} 100%{box-shadow:0 0 0 rgba(139,0,0,0)} }
.badge-update{ display:inline-block; margin-left:.4em; padding:.1em .4em; background:#8b0000; color:#fff; font-size:.75em; border-radius:3px }

/* モーダル */
#modal{ position:fixed; inset:0; background:rgba(0,0,0,.86); z-index:9999; display:flex; justify-content:center; align-items:center; padding:20px; text-align:left; opacity:0; pointer-events:none; transition:opacity .22s }
#modal.open{ opacity:1; pointer-events:auto }
.modal-inner{ width:92%; max-width:680px; background:#0b0b0b; border:1px solid rgba(255,255,255,.08); border-radius:10px; padding:16px; transform:scale(.96) translateY(8px); transition:transform .22s, box-shadow .22s; box-shadow:0 18px 50px rgba(0,0,0,.55) }
#modal.open .modal-inner{ transform:scale(1) translateY(0); box-shadow:0 22px 60px rgba(0,0,0,.65) }
.modal-title{ margin:0 0 10px; color:#b01212 }
.modal-body{ line-height:1.9 }
.modal-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:12px }

/* イントロ（黒地・白字） */
.intro-box{ max-width:920px; margin:0 auto; padding:20px }
.intro-line{
  color:#f2f2f2; font-size:clamp(16px,4.2vw,22px); line-height:1.9; letter-spacing:.04em;
  opacity:0; animation:introNoise 2.6s ease .3s forwards;
  text-shadow:0 0 6px rgba(255,255,255,.05), 0 0 1px rgba(255,255,255,.3);
}
@keyframes introNoise{
  0%{opacity:0; filter:brightness(0.8) contrast(1.2)}
  20%{opacity:1}
  30%{opacity:.88}
  45%{opacity:1}
  65%{opacity:.9}
  100%{opacity:1; filter:none}
}

/* トランジション＆FX */
.rgb-split *{ text-shadow:1px 0 rgba(255,0,0,.25), -1px 0 rgba(0,255,255,.25); filter:contrast(1.04) saturate(1.04) }
.screen-tear::after{
  content:""; position:absolute; left:0; right:0; height:14px; top:42%;
  background:linear-gradient(to right,rgba(255,255,255,.12),rgba(0,0,0,0)); mix-blend-mode:screen; opacity:0; transform:translateX(-8px);
  animation:screenTear .22s steps(1) 1;
}
@keyframes screenTear{0%{opacity:0}20%{opacity:.35;transform:translateX(8px)}100%{opacity:0;transform:translateX(0)}}
.global-break{ animation:globalBreakA .18s steps(1) 1, globalBreakB .28s ease 1; filter:invert(.04) contrast(1.15) saturate(1.12) hue-rotate(6deg) }
@keyframes globalBreakA{ 0%{transform:none} 50%{transform:skewX(3deg) translateX(2px)} 100%{transform:none} }
@keyframes globalBreakB{ 0%{box-shadow:inset 0 0 0 rgba(255,255,255,0)} 50%{box-shadow:inset 0 0 48px rgba(255,255,255,.06)} 100%{box-shadow:inset 0 0 0 rgba(255,255,255,0)} }
.jolt{ animation:jolt .22s steps(1) 1 }
@keyframes jolt{0%{transform:none;filter:none}15%{transform:skewX(2deg) translateX(1px)}30%{transform:skewX(-2deg) translateX(-1px);filter:contrast(1.08)}45%{transform:skewY(1deg)}60%{transform:skewY(-1deg)}75%{transform:translateX(1px)}100%{transform:none;filter:none}}

/* スマホ */
@media(max-width:430px){
  .scrollbox{ max-height:60vh }
  .panel-title{ letter-spacing:.12em }
}
