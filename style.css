/* ===== 基本 ===== */
*{box-sizing:border-box}
html{height:100%;-webkit-text-size-adjust:100%}
body{
  margin:0;background:#000;color:#eee;
  /* ウィンドウ外は貂明朝（代替） */
  font-family: "A-OTF A1 Mincho","A1明朝","Hiragino Mincho ProN","Yu Mincho",serif;
  -webkit-font-smoothing:antialiased;
}
.no-scroll{overflow:hidden}
.allow-scroll{overflow:auto}

/* 古いレトロUIは強制非表示（キャッシュ残留対策） */
.browser{display:none !important}

/* 画面：中央寄せ（縦横） */
.screen{
  display:none;min-height:100vh;width:100%;padding:0 6%;
  justify-content:center;align-items:center;text-align:center;position:relative;
}
.screen.active{display:flex}
.center{max-width:860px;width:100%}
.spaced{letter-spacing:.22em;line-height:1.9}
.percent{margin-top:.6rem;color:#777}
.small-note{font-size:.82rem;opacity:.9}
.small-note.red{color:#8b0000}
.nowrap{white-space:nowrap}

/* ページスクロールを許す画面 */
.screen.page-scroll{align-items:flex-start;padding-top:clamp(24px,5vh,60px);padding-bottom:64px}

/* 青トーン背景（受付/発祥） */
#screen-entry{background:linear-gradient(180deg, #0b1220 0%, #08101a 100%)}
#screen-story{background:linear-gradient(180deg, #0b1220 0%, #0a0f17 100%)}

/* ノイズ動画（常に上に重ねる） */
.noise-layer{
  position:fixed;inset:0;z-index:5000;pointer-events:none;
  object-fit:cover;opacity:.22;mix-blend-mode:screen; /* 文字上にも馴染む */
  will-change:transform, opacity;
}
.noise-layer.boost{opacity:.36}

/* トランジションノイズ（切替時） */
#transition-noise{
  position:fixed;inset:0;z-index:6000;pointer-events:none;opacity:0;transition:opacity .22s ease;
}
#transition-noise.show{opacity:1}
#transition-noise .t-grain{
  position:absolute;inset:0;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.2), rgba(0,0,0,0) 40%),
    repeating-conic-gradient(from 0deg, rgba(255,255,255,.35) 0 .7deg, rgba(0,0,0,0) .7deg 1.4deg);
  mix-blend-mode:screen;opacity:.22;animation:tPulse 0.28s steps(1) 3;
}
#transition-noise .t-scan{
  position:absolute;left:0;right:0;height:18px;top:-18px;
  background:linear-gradient(to bottom, rgba(255,255,255,.45), rgba(255,255,255,0));
  animation:tScan .32s linear 1;
}
@keyframes tPulse{0%{opacity:.1}50%{opacity:.35}100%{opacity:.2}}
@keyframes tScan{0%{transform:translateY(0)}100%{transform:translateY(110vh)}}

/* FXレイヤ（上） */
#fx{position:fixed;inset:0;pointer-events:none;z-index:5500;mix-blend-mode:overlay}
.fx-grain,.fx-scratches,.fx-rollbar{position:absolute;inset:0}
.fx-grain{
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.06), rgba(0,0,0,0) 38%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.05), rgba(0,0,0,0) 42%),
    repeating-conic-gradient(from 0deg, rgba(255,255,255,.07) 0 .5deg, rgba(0,0,0,0) .5deg 1deg);
  opacity:.26;animation:fxGrainShift 1.2s steps(2) infinite
}
@keyframes fxGrainShift{0%{transform:translate(0,0)}50%{transform:translate(-1px,1px)}100%{transform:translate(0,0)}}
.fx-scratches{
  background:
    repeating-linear-gradient(to right, rgba(255,255,255,.09) 0 1px, rgba(0,0,0,0) 1px 4px),
    repeating-linear-gradient(to right, rgba(255,255,255,.04) 0 2px, rgba(0,0,0,0) 2px 7px);
  opacity:.14;animation:fxScratchDrift 12s linear infinite
}
@keyframes fxScratchDrift{0%{transform:translateX(0)}100%{transform:translateX(-60px)}}
.fx-rollbar{background:linear-gradient(to bottom,rgba(255,255,255,0),rgba(255,255,255,.25) 50%,rgba(255,255,255,0));opacity:0;transform:translateY(-120%)}
.fx-rollbar.run{animation:fxRoll 2.2s linear 1}
@keyframes fxRoll{0%{opacity:0;transform:translateY(-120%)}10%{opacity:.45}90%{opacity:.45}100%{opacity:0;transform:translateY(120%)}}

/* RGBずれ・ドリフト・ティア・強グリッチ */
.rgb-split *{text-shadow:1px 0 rgba(255,0,0,.35),-1px 0 rgba(0,255,255,.35);filter:contrast(1.07) saturate(1.05)}
.vsync-drift{animation:vsyncDrift 6s ease-in-out infinite alternate}
@keyframes vsyncDrift{0%{transform:translateY(0)}100%{transform:translateY(1.6px)}}
.screen-tear::after{
  content:"";position:absolute;left:0;right:0;height:14px;top:40%;
  background:linear-gradient(to right,rgba(255,255,255,.12),rgba(0,0,0,0));mix-blend-mode:screen;opacity:0;transform:translateX(-8px);
  animation:screenTear .22s steps(1) 1
}
@keyframes screenTear{0%{opacity:0}20%{opacity:.4;transform:translateX(8px)}100%{opacity:0;transform:translateX(0)}}
.global-break{
  animation:globalBreakA .18s steps(1) 1, globalBreakB .28s ease 1;
  filter:invert(.06) contrast(1.22) saturate(1.15) hue-rotate(6deg)
}
@keyframes globalBreakA{0%{transform:none}50%{transform:skewX(3deg) translateX(2px)}100%{transform:none}}
@keyframes globalBreakB{0%{box-shadow:inset 0 0 0 rgba(255,0,0,0)}50%{box-shadow:inset 0 0 48px rgba(255,255,255,.08)}100%{box-shadow:inset 0 0 0 rgba(255,0,0,0)}}

/* “ガガガ” */
@keyframes jolt{0%{transform:none;filter:none}15%{transform:skewX(2deg) translateX(1px)}
30%{transform:skewX(-2deg) translateX(-1px);filter:contrast(1.08)}45%{transform:skewY(1deg)}
60%{transform:skewY(-1deg)}75%{transform:translateX(1px)}100%{transform:none;filter:none}}
.jolt{animation:jolt .22s steps(1) 1}

/* ===== 新ウィンドウ：Specimen Viewer ===== */
:root{ --ui-gothic: "dnp-shuei-gothic-kin-std","Yu Gothic","Hiragino Kaku Gothic ProN",Meiryo,sans-serif; }

.fw-gothic{ font-family:var(--ui-gothic) }

.viewer{
  position:relative;z-index:2;width:100%;max-width:900px;border-radius:12px;
  background:linear-gradient(180deg,#0f0f12 0%, #111216 100%);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.04),
    inset 0 0 0 2px rgba(0,0,0,.6),
    0 18px 60px rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.08);
  overflow:hidden;
}
.viewer::before{
  /* 内側グロー（ガラス層） */
  content:"";position:absolute;inset:0;pointer-events:none;z-index:1;
  background:radial-gradient(ellipse at 50% -20%, rgba(255,255,255,.08), transparent 55%);
  mix-blend-mode:screen;
}
.viewer-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08);
  background:linear-gradient(180deg, #15161b, #0f1013); color:#cfd2d6; font-family:var(--ui-gothic);
}
.viewer-title{letter-spacing:.22em;font-size:.9rem}
.viewer .led{
  display:inline-block;width:10px;height:10px;border-radius:50%;
  background:radial-gradient(circle,#ff1a1a 0%, #8b0000 60%, #300 100%);
  box-shadow:0 0 8px #ff2626, 0 0 16px rgba(255,38,38,.4);
}
.viewer .dots{opacity:.35}

.viewer-body{
  padding:14px; text-align:left; color:#e8e8e8; position:relative; z-index:2; font-family:var(--ui-gothic);
}

/* ウィンドウサイズ調整（受付/発祥/たすけて） */
.win.entry-win{ max-width:780px }
.win.win-main{ max-width:900px }
.win.win-mini{ width:min(520px,100%); margin-left:auto }

/* スクロールボックス（縦のみ） */
.scrollbox{
  max-height:56vh; overflow-y:auto; overflow-x:hidden;
  padding:12px; background:#0b0c0f; color:#e6e6e6; border:1px solid rgba(255,255,255,.08);
  border-radius:8px;
  box-shadow:inset 0 0 20px rgba(0,0,0,.45);
}
.scrollbox::-webkit-scrollbar{width:10px}
.scrollbox::-webkit-scrollbar-track{background:#0e1014;box-shadow:inset 1px 1px 0 rgba(255,255,255,.08), inset -1px -1px 0 rgba(0,0,0,.6)}
.scrollbox::-webkit-scrollbar-thumb{background:#1b1e24;border:2px solid #000;box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}

/* 見出し類（滲み付与） */
.kaiki{
  color:#e5e5e5;text-shadow:0 0 12px rgba(255,255,255,.08), 0 0 24px rgba(255,255,255,.06);
  font-size:clamp(22px,8.2vw,40px);letter-spacing:.08em;white-space:nowrap;
}
.glow .kaiki-line2{ color:#c33; text-shadow:0 0 10px rgba(255,80,80,.36),0 0 22px rgba(255,80,80,.2) }
.kaiki-sub{margin:.2rem 0 10px;color:#b44;letter-spacing:.12em;font-size:1rem}
.who-line{color:#bbb;letter-spacing:.18em;margin:.2rem 0 .8rem;font-size:clamp(12px,3.6vw,14px)}
.ink-sm{ position:relative; text-shadow:0 0 .4px rgba(255,255,255,.1),0 0 1.6px rgba(255,255,255,.08) }

/* “たすけて” */
.help-chant{
  color:#c33;letter-spacing:0;font-weight:700;opacity:0;transition:opacity .25s ease; font-family:var(--ui-gothic);
}
.help-chant.show{opacity:1}

/* ボタン（押下感強化） */
.btn{
  background:#14161b;color:#e6e6e6;border:1px solid rgba(255,255,255,.14);
  border-radius:8px;margin-top:16px;padding:.6rem 1.05rem;cursor:pointer;
  transition:transform .08s ease, color .2s, box-shadow .12s, background .2s, filter .2s;
  box-shadow:0 8px 20px rgba(0,0,0,.35), inset 0 0 0 rgba(255,255,255,0);
  font-family:var(--ui-gothic);
  user-select:none;
}
.btn:hover{color:#fff;background:#191c22;box-shadow:0 10px 26px rgba(0,0,0,.45)}
.btn:active{transform:translateY(1px) scale(.985); filter:brightness(.95)}
.btn.pressed{
  animation:pressPop .16s ease 1;
}
@keyframes pressPop{
  0%{transform:scale(.98)}
  100%{transform:scale(1)}
}

/* 受付入力 */
.entry-form{display:flex;gap:10px;align-items:center;margin:.6rem 0 .4rem}
#nick-input{
  width:100%;max-width:380px;padding:.6rem .7rem;background:#0b0c0f;color:#e6e6e6;border:1px solid rgba(255,255,255,.12);
  border-radius:8px; box-shadow:inset 0 0 18px rgba(0,0,0,.45);
}
#nick-input::placeholder{color:#aaa}
#nick-input:focus{outline:none;border-color:#b44}

/* カルテ一覧 */
.records{position:relative;z-index:2;width:100%;max-width:900px;text-align:left}
.records-title{text-align:center;color:#b44;letter-spacing:.12em}
.card{
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.08);
  border-radius:8px;padding:12px;margin:12px 0;
  box-shadow:0 10px 30px rgba(0,0,0,.28), inset 0 0 0 rgba(255,255,255,0);
}
.karte{width:100%;border-collapse:collapse;table-layout:fixed}
.karte th,.karte td{padding:8px;border-bottom:1px dashed rgba(255,255,255,.08);vertical-align:top;word-break:break-word}
.karte th{white-space:nowrap;width:30%}

/* 自動更新 */
.card.updated{animation:updateBlink 1.2s ease 1}
@keyframes updateBlink{0%{box-shadow:0 0 0 rgba(139,0,0,0)}20%{box-shadow:0 0 24px rgba(139,0,0,.45)}100%{box-shadow:0 0 0 rgba(139,0,0,0)}}
.badge-update{display:inline-block;margin-left:.4em;padding:.1em .4em;background:#b44;color:#fff;font-size:.75em;border-radius:3px}

/* モーダル（最前面） */
#modal{position:fixed;inset:0;background:rgba(0,0,0,.86);z-index:10000;display:flex;justify-content:center;align-items:center;padding:20px;text-align:left;opacity:0;pointer-events:none;transition:opacity .22s}
#modal.open{opacity:1;pointer-events:auto}
.modal-inner{width:92%;max-width:680px;background:#0b0b0b;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px;transform:scale(.96) translateY(8px);transition:transform .22s,box-shadow .22s;box-shadow:0 18px 50px rgba(0,0,0,.55)}
#modal.open .modal-inner{transform:scale(1) translateY(0);box-shadow:0 22px 60px rgba(0,0,0,.65)}
.modal-title{margin:0 0 10px;color:#c33;font-family:var(--ui-gothic)}
.modal-body{line-height:1.92;font-family:var(--ui-gothic)}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}

/* モザイク（斜めしましま） */
.mosaic{position:relative;display:inline-block;color:transparent;padding:0 .25em;border-radius:2px;outline:1px solid rgba(255,255,255,.12)}
.mosaic::after{
  content:"";position:absolute;inset:0;border-radius:2px;
  background:repeating-linear-gradient(135deg,rgba(20,20,20,1) 0 6px,rgba(0,0,0,.78) 6px 12px),
             linear-gradient(to bottom,rgba(255,255,255,.05),rgba(0,0,0,.0));
  opacity:.96;animation:mosaicPulse 3s ease-in-out infinite
}
@keyframes mosaicPulse{0%,100%{opacity:.96}50%{opacity:.86}}

/* 文字化けフラッシュ */
.corrupt-flash{animation:corruptFlash .18s steps(1) 1}
@keyframes corruptFlash{0%{filter:none}50%{filter:contrast(1.15) saturate(1.1)}100%{filter:none}}

/* 微振動（エラー用） */
@keyframes microShake{0%{transform:translateX(0)}25%{transform:translateX(1px)}50%{transform:translateX(-1px)}75%{transform:translateX(1px)}100%{transform:translateX(0)}}
.entry-error{animation:microShake .18s linear 1}

/* ===== 前置き（ノイズまとめフェード＋背面ライト点滅） ===== */
#screen-preamble{background:#000}
.preamble-wrap{
  display:inline-block; padding:22px 24px; border-radius:8px; position:relative;
  animation:noiseGroupIn 1.4s ease forwards; opacity:0;
}
@keyframes noiseGroupIn{
  0%{opacity:0; filter:blur(2px) brightness(.85); clip-path:inset(45% 0 45% 0)}
  35%{opacity:.55; filter:blur(1.2px)}
  100%{opacity:1; filter:none; clip-path:inset(0 0 0 0)}
}
.preamble-wrap::before{
  content:""; position:absolute; inset:-20% -10%; pointer-events:none; z-index:-1;
  background:radial-gradient(circle at 50% 50%, rgba(255,255,255,.12), transparent 60%);
  animation:pulseLight 2.2s ease-in-out infinite;
}
@keyframes pulseLight{0%,100%{opacity:.45}50%{opacity:.85}}
.preamble{
  font-size:clamp(13px, 3.4vw, 17px); color:#f0f0f0; margin:.45em 0; text-align:center;
}
.all-ink{
  position:relative;
  text-shadow:
    0 0 .4px rgba(255,255,255,.12),
    0 0 1.6px rgba(255,255,255,.1);
}
.all-ink::after{
  content:attr(data-text);
  position:absolute; inset:0; pointer-events:none;
  color:inherit;
  filter:blur(0.9px) contrast(1.05) saturate(.9);
  opacity:.28;
}

/* ===== 滲み/かすれ ===== */
.ink-smear{ position:relative; text-shadow:0 0 .3px rgba(255,255,255,.1), 0 0 1.2px rgba(255,255,255,.08) }
.print-rough{ position:relative; mask-image:radial-gradient(#000 60%, transparent 62%); mask-size:6px 6px; mask-repeat:repeat; opacity:.96 }
.crt-bleed{ position:relative; text-shadow:1px 0 rgba(255,0,0,.18), -1px 0 rgba(0,255,255,.18), 0 0 1px rgba(255,255,255,.12); filter:blur(.15px) saturate(1.05) contrast(1.05) }
.ghost-ink{ position:relative }
.ghost-ink::before{ content:attr(data-text); position:absolute; inset:0; transform:translate(0.4px, 0.6px); opacity:.18; filter:blur(0.4px) }

/* スマホ */
@media (max-width:430px){
  .scrollbox{max-height:62vh}
  .viewer-title{letter-spacing:.18em; font-size:.86rem}
}
