/* ====== ベース ====== */
*{box-sizing:border-box}
html,body{height:100%}
html{ -webkit-text-size-adjust:100% }
body{
  margin:0;background:#000;color:#eee;overflow:hidden; /* ページ全体のスクロール禁止 */
  font-family:"dnp-shuei-gothic-kin-std","Yu Gothic","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
  -webkit-font-smoothing:antialiased;
}

/* 画面（各セクションは切替で1枚のみ表示） */
.screen{
  display:none;min-height:100vh;width:100%;padding:0 6%;
  justify-content:center;align-items:center;text-align:center;position:relative;
}
.screen.active{display:flex}
.hidden{display:none}
.center{max-width:760px;width:100%}
.spaced{letter-spacing:.22em;line-height:1.9}
.percent{margin-top:.6rem;color:#777}

/* ====== 背景動画（最背面固定） ====== */
.bg-video{
  position:fixed;inset:0;object-fit:cover;z-index:-1;opacity:.35;pointer-events:none;display:none;
  filter:contrast(1.05) saturate(.95) brightness(.95);
}
.tint-blue{ filter:hue-rotate(190deg) saturate(.9) brightness(.9) }

/* 画面に応じて表示する（JSでdisplay切替） */
#bg-story{display:none}
#bg-records{display:none}

/* ====== 全体FX（CRT/粒状/走査線/ロールバー/ビネット） ====== */
#fx{position:fixed;inset:0;pointer-events:none;z-index:5}
.fx-grain{position:absolute;inset:0;opacity:.25;mix-blend-mode:overlay;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.05), rgba(0,0,0,0) 40%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.04), rgba(0,0,0,0) 44%),
    repeating-conic-gradient(from 0deg, rgba(255,255,255,.06) 0 .5deg, rgba(0,0,0,0) .5deg 1deg);
  animation:grainShift 1.2s steps(2) infinite;
}
@keyframes grainShift{0%{transform:translate(0,0)}50%{transform:translate(-1px,1px)}100%{transform:translate(0,0)}}

.fx-scanlines{position:absolute;inset:0;opacity:.35;mix-blend-mode:overlay;
  background:repeating-linear-gradient(to bottom,rgba(255,255,255,.055) 0 1px,transparent 1px 3px);
  animation:scanFlicker 4.5s steps(1) infinite;
}
@keyframes scanFlicker{0%,98%{opacity:.35}99%{opacity:.42}100%{opacity:.35}}

.fx-vignette{position:absolute;inset:-3%;pointer-events:none;opacity:.65;
  background:radial-gradient(ellipse at center, rgba(255,255,255,.02) 0%, rgba(255,255,255,0) 56%, rgba(0,0,0,.55) 100%);
  border-radius:2.6%/1.9%;
}

.fx-rollbar{position:absolute;inset:0;opacity:0;transform:translateY(-120%);
  background:linear-gradient(to bottom,rgba(255,255,255,0),rgba(255,255,255,.34) 50%,rgba(255,255,255,0));
}
.fx-rollbar.run{animation:fxRoll 2.2s linear 1}
@keyframes fxRoll{0%{opacity:0;transform:translateY(-120%)}10%{opacity:.5}90%{opacity:.5}100%{opacity:0;transform:translateY(120%)}}

/* ガガガ・ティア・RGBズレ・全体ブレイク */
@keyframes jolt{0%{transform:none;filter:none}15%{transform:skewX(2deg) translateX(1px)}
30%{transform:skewX(-2deg) translateX(-1px);filter:contrast(1.08)}45%{transform:skewY(1deg)}
60%{transform:skewY(-1deg)}75%{transform:translateX(1px)}100%{transform:none;filter:none}}
.jolt{animation:jolt .22s steps(1) 1}

.rgb-split *{text-shadow:1px 0 rgba(255,0,0,.35), -1px 0 rgba(0,255,255,.35);filter:contrast(1.05) saturate(1.05)}
.vsync-drift{animation:vsyncDrift 6s ease-in-out infinite alternate}
@keyframes vsyncDrift{0%{transform:translateY(0)}100%{transform:translateY(1.6px)}}
.screen-tear::after{
  content:"";position:absolute;left:0;right:0;height:14px;top:40%;
  background:linear-gradient(to right,rgba(255,255,255,.15),rgba(0,0,0,0));
  mix-blend-mode:screen;opacity:0;transform:translateX(-8px);
  animation:screenTear .22s steps(1) 1;
}
@keyframes screenTear{0%{opacity:0}20%{opacity:.5;transform:translateX(8px)}100%{opacity:0;transform:translateX(0)}}
.global-break{
  animation:globalBreakA .18s steps(1) 1, globalBreakB .28s ease 1;
  filter:invert(.06) contrast(1.25) saturate(1.2) hue-rotate(6deg)
}
@keyframes globalBreakA{0%{transform:none}50%{transform:skewX(3deg) translateX(2px)}100%{transform:none}}
@keyframes globalBreakB{0%{box-shadow:inset 0 0 0 rgba(255,0,0,0)}
  50%{box-shadow:inset 0 0 48px rgba(255,255,255,.08)}100%{box-shadow:inset 0 0 0 rgba(255,0,0,0)}}

/* ====== レトロUI（Win98風） ====== */
.browser.retro{
  position:relative;z-index:2;width:100%;max-width:920px;background:#c0c0c0;border:2px solid #000;
  box-shadow:0 0 0 1px #fff inset,0 0 0 2px #808080 inset,0 0 0 3px #fff inset;overflow:hidden;
}
.retro-titlebar{
  display:flex;align-items:center;justify-content:space-between;background:#000080;color:#fff;padding:6px 8px;
  letter-spacing:.28em;font-size:.9rem;user-select:none
}
.retro-title{font-weight:bold;white-space:nowrap}
.retro-controls{display:flex;gap:6px}
.retro-controls .ctrl{min-width:22px;text-align:center;padding:2px 4px;background:#c0c0c0;color:#000;border:2px solid #000;
  box-shadow:0 0 0 1px #fff inset,0 0 0 2px #808080 inset,0 0 0 3px #fff inset}
.retro-controls .ctrl:active{box-shadow:0 0 0 1px #808080 inset,0 0 0 2px #fff inset,0 0 0 3px #808080 inset}
.retro-controls .ctrl.close{color:#800000}
.retro-pane{padding:12px;text-align:left;color:#000;background:#c0c0c0;position:relative}

/* CRT感（面の樽型+走査線補強） */
.browser.retro.crt,.records.crt{position:relative;isolation:isolate;overflow:hidden;filter:contrast(1.03) saturate(0.98)}
.browser.retro.crt::before,.records.crt::before{
  content:"";position:absolute;inset:-4%;z-index:8;pointer-events:none;
  background:radial-gradient(ellipse at center,rgba(255,255,255,.02) 0%,rgba(255,255,255,0) 60%,rgba(0,0,0,.5) 100%);
  border-radius:2.6%/1.9%;transform:perspective(1000px) scale(1.018)
}
.browser.retro.crt::after,.records.crt::after{
  content:"";position:absolute;inset:0;z-index:8;pointer-events:none;
  background:repeating-linear-gradient(to bottom,rgba(255,255,255,.06) 0 1px,transparent 1px 3px);
  mix-blend-mode:overlay;opacity:.55;animation:crtFlicker 4.5s steps(1) infinite
}
@keyframes crtFlicker{0%,98%{opacity:.55}99%{opacity:.62}100%{opacity:.55}}

/* ====== 見出し/文字 ====== */
.kaiki{
  color:#8b0000;text-shadow:0 0 12px rgba(139,0,0,.35);
  display:inline-block;line-height:1.18;letter-spacing:.06em;
  font-size:clamp(20px,9vw,44px);
}
.kaiki-line{display:block}
@media (min-width:480px){ .kaiki-line{display:inline} .kaiki {word-spacing:.2em} }

.kaiki-sub{margin:.2rem 0 10px;color:#8b0000;letter-spacing:.12em;font-size:1rem}
.who-line{color:#aaa;letter-spacing:.18em;margin:.2rem 0 .8rem;font-size:clamp(12px,3.6vw,14px)}
.warning{color:#8b0000}

/* ====== 受付フォーム（大きめに） ====== */
.entry-form{display:flex;gap:10px;align-items:center;margin:.8rem 0 .5rem;flex-wrap:wrap}
#nick-input{
  width:min(520px,100%);padding:.7rem .8rem;font-size:1.05rem;background:#fff;color:#111;border:2px solid #000;
  box-shadow:0 0 0 1px #fff inset,0 0 0 2px #808080 inset,0 0 0 3px #fff inset
}
#nick-input:focus{outline:none;border-color:#8b0000}
.entry-note{color:#333;font-size:.9rem;margin:.25rem 0 0}

/* ====== 発祥配置 ====== */
.stack{display:flex;flex-direction:column;gap:12px;width:min(960px,100%)}
.win-main{z-index:2}
.win-mini{z-index:3;width:min(520px,100%);margin-left:auto}
.win-mini.hidden{display:none}

/* ボックス出現（下からフェードイン） */
.appear{opacity:0;transform:translateY(14px);animation:boxIn .38s ease forwards}
@keyframes boxIn{to{opacity:1;transform:translateY(0)}}

/* 発祥本文（タイプライター無し／狭めの行間） */
.story-body{
  color:#111;line-height:1.78;font-size:clamp(13px,3.5vw,17px);letter-spacing:.01em;
  white-space:normal;word-break:normal;overflow-wrap:anywhere;line-break:strict;text-wrap:pretty;
  opacity:0;transition:opacity .5s ease; /* 遅れてフェードイン */
}
.story-body.show{opacity:1}
.story-body p{margin:0 0 1.05em 0}

/* スクロールボックス（縦のみ） */
.scrollbox{
  max-height:55vh;overflow-y:auto;overflow-x:hidden;padding:10px;background:#fff;color:#111;border:2px solid #000;
  box-shadow:0 0 0 1px #fff inset,0 0 0 2px #808080 inset,0 0 0 3px #fff inset
}
.scrollbox::-webkit-scrollbar{width:10px}
.scrollbox::-webkit-scrollbar-track{background:#c0c0c0;box-shadow:inset 1px 1px 0 #fff,inset -1px -1px 0 #808080}
.scrollbox::-webkit-scrollbar-thumb{background:#e0e0e0;border:2px solid #000;box-shadow:inset 0 0 0 1px #fff,inset 0 0 0 2px #808080,inset 0 0 0 3px #fff}

/* “たすけて”タイプライター（詰め気味） */
.help-chant{color:#8b0000;letter-spacing:-.02em;font-weight:600;opacity:0;transition:opacity .25s ease}
.help-chant.show{opacity:1}

/* ====== ボタン ====== */
.btn{
  background:#c0c0c0;color:#000;border:2px solid #000;
  box-shadow:0 0 0 1px #fff inset,0 0 0 2px #808080 inset,0 0 0 3px #fff inset;
  border-radius:2px;margin-top:16px;padding:.62rem 1.05rem;cursor:pointer;
  transition:transform .1s,color .2s,box-shadow .12s
}
.btn:hover{color:#8b0000}
.btn:active{box-shadow:0 0 0 1px #808080 inset,0 0 0 2px #fff inset,0 0 0 3px #808080 inset;transform:translateY(1px) scale(.99)}

/* ====== カルテ一覧 ====== */
.records{position:relative;z-index:2;width:100%;max-width:960px;text-align:left}
.records-title{text-align:center;color:#8b0000;letter-spacing:.12em;margin:.2rem 0}
.records-note{margin:.2rem 0 .6rem;text-align:center}
.card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:12px;margin:12px 0}
.karte{width:100%;border-collapse:collapse;table-layout:fixed}
.karte th,.karte td{padding:8px;border-bottom:1px dashed rgba(255,255,255,.08);vertical-align:top;word-break:break-word}
.karte th{white-space:nowrap;width:30%}

/* 自動更新 */
.card.updated{animation:updateBlink 1.2s ease 1}
@keyframes updateBlink{0%{box-shadow:0 0 0 rgba(139,0,0,0)}20%{box-shadow:0 0 24px rgba(139,0,0,.45)}100%{box-shadow:0 0 0 rgba(139,0,0,0)}}
.badge-update{display:inline-block;margin-left:.4em;padding:.1em .4em;background:#8b0000;color:#fff;font-size:.75em;border-radius:3px}

/* モーダル */
#modal{position:fixed;inset:0;background:rgba(0,0,0,.86);z-index:9999;display:flex;justify-content:center;align-items:center;padding:20px;text-align:left;opacity:0;pointer-events:none;transition:opacity .22s}
#modal.open{opacity:1;pointer-events:auto}
.modal-inner{width:92%;max-width:680px;background:#0b0b0b;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:16px;transform:scale(.96) translateY(8px);transition:transform .22s,box-shadow .22s;box-shadow:0 18px 50px rgba(0,0,0,.55)}
#modal.open .modal-inner{transform:scale(1) translateY(0);box-shadow:0 22px 60px rgba(0,0,0,.65)}
.modal-title{margin:0 0 10px;color:#8b0000}
.modal-body{line-height:1.9}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}

/* 伏せ/モザイク */
.mosaic{position:relative;display:inline-block;color:transparent;padding:0 .25em;border-radius:2px;outline:1px solid rgba(255,255,255,.12)}
.mosaic::after{
  content:"";position:absolute;inset:0;border-radius:2px;
  background:repeating-linear-gradient(135deg,rgba(20,20,20,1) 0 6px,rgba(0,0,0,.78) 6px 12px),
             linear-gradient(to bottom,rgba(255,255,255,.05),rgba(0,0,0,.0));
  opacity:.96;animation:mosaicPulse 3s ease-in-out infinite
}
@keyframes mosaicPulse{0%,100%{opacity:.96}50%{opacity:.86}}
.blacked{background:#000;color:transparent;border-radius:2px;padding:0 6px;display:inline-block}
.marker{background:linear-gradient(90deg,rgba(0,0,0,.96),rgba(0,0,0,.88));color:transparent;padding:0 6px;border-radius:2px}

/* 文字化けフラッシュ */
.corrupt-flash{animation:corruptFlash .18s steps(1) 1}
@keyframes corruptFlash{0%{filter:none}50%{filter:contrast(1.15) saturate(1.1)}100%{filter:none}}

/* エラー（入力時の小揺れ） */
@keyframes microShake{0%{transform:translateX(0)}25%{transform:translateX(1px)}50%{transform:translateX(-1px)}75%{transform:translateX(1px)}100%{transform:translateX(0)}}
.entry-error{animation:microShake .18s linear 1}

/* スマホ */
@media (max-width:430px){
  .scrollbox{max-height:60vh}
  .retro-titlebar{letter-spacing:.22em;font-size:.85rem}
  .story-title{letter-spacing:.2em}
}

/* ====== 受付が下に寄る対策（モバイルvh補正 & 受付だけ微上げ） ====== */

/* まず、モバイルで正しい高さが使えるようにカスタムvh */
:root { --vh: 1vh; }

/* 100dvh に対応しているブラウザではそれを使う */
@supports (height: 100dvh) {
  .screen { min-height: 100dvh; }
}

/* それ以外は JS で更新する --vh を使う */
@supports not (height: 100dvh) {
  .screen { min-height: calc(var(--vh, 1vh) * 100); }
}

/* 受付画面だけ少し上げる（端末の高さに応じて微調整） */
#screen-entry .browser.retro {
  transform: translateY(-4vh);
}
@media (min-height: 800px) {
  #screen-entry .browser.retro { transform: translateY(-6vh); }
}
@media (max-height: 640px) {
  #screen-entry .browser.retro { transform: translateY(-6vh); }
}
