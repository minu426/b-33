<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>B-33型《バーバラさん》 診断記録</title>

<!-- Adobe Fonts（秀英角ゴシック金） -->
<script>
(function(d){var c={kitId:'ouz3iep',scriptTimeout:3000,async:true},h=d.documentElement,
t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},c.scriptTimeout),
s=d.createElement("script"),f=false,x=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";
s.src='https://use.typekit.net/'+c.kitId+'.js';s.async=true;
s.onload=s.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;
f=true;clearTimeout(t);try{Typekit.load(c)}catch(e){}};x.parentNode.insertBefore(s,x)})(document);
</script>

<link rel="stylesheet" href="style.css?v=80" />
</head>
<body>

<!-- 常時ノイズ動画（全画面重ね） -->
<video id="noise-layer" class="noise-layer" autoplay muted loop playsinline preload="auto"></video>

<!-- 追加：全画面エフェクトレイヤ -->
<div id="fx" aria-hidden="true">
  <div class="fx-grain"></div>
  <div class="fx-scratches"></div>
  <div class="fx-rollbar"></div>
</div>

<!-- -1) 前置き（真っ暗＋白文字、ノイズっぽい出方） -->
<section id="screen-preamble" class="screen active">
  <div class="center">
    <div class="preamble-wrap">
      <p class="preamble-line">本日はご来院、ありがとうございました。</p>
      <p class="preamble-line">患者様の処方箋より怪異の詳細な情報を開示いたします。</p>
    </div>
  </div>
</section>

<!-- 0) 受付 -->
<section id="screen-entry" class="screen">
  <div class="browser retro crt win entry-win">
    <div class="retro-titlebar">
      <span class="retro-title">受　付</span>
      <div class="retro-controls"><span class="ctrl">_</span><span class="ctrl">□</span><span class="ctrl close">×</span></div>
    </div>
    <div class="retro-pane">
      <p class="phosphor small-note" data-no-corrupt>
        診断で使用したお名前を入力してください。<br>
        <strong>※ 実名はお控えください（渾名・イニシャル推奨）</strong>
      </p>
      <div class="entry-form">
        <input id="nick-input" type="text" inputmode="text" autocomplete="off" autocapitalize="off" maxlength="20"
               placeholder="例）化神魔 / M.N / 来訪者" aria-label="お名前（渾名）">
        <button id="btn-start" class="btn">データの照合</button>
      </div>
      <p class="entry-note small-note" data-no-corrupt>
        入力されたお名前は画面表示のみに使用され、保存されません。
      </p>
    </div>
  </div>
</section>

<!-- 1) 初回ロード -->
<section id="screen-loading" class="screen">
  <div class="center">
    <p class="spaced">診断情報を準備しています…</p>
    <p id="load-per" class="percent">0%</p>
  </div>
</section>

<!-- 2) 名前＋見出し -->
<section id="screen-name" class="screen">
  <div class="center">
    <p class="who-line">―― <span id="who-name">来訪者</span> 様の診断結果 ――</p>
    <h1 class="kaiki glow">
      <span class="kaiki-line1">B-33型</span><br>
      <span class="kaiki-line2">《バーバラさん》</span>
    </h1>
  </div>
</section>

<!-- 3) 発祥（本文ウィンドウ + “たすけて”ミニウィンドウ） -->
<section id="screen-story" class="screen page-scroll">
  <div class="stack">
    <!-- 本文ウィンドウ -->
    <div class="browser retro crt win win-main">
      <div class="retro-titlebar">
        <span class="retro-title nowrap">発　祥　ス　ト　ー　リ　ー</span>
        <div class="retro-controls"><span class="ctrl">_</span><span class="ctrl">□</span><span class="ctrl close">×</span></div>
      </div>
      <div class="retro-pane">
        <h2 class="kaiki-sub chromatic">“B-33型《バーバラさん》”</h2>
        <div id="story-scroll" class="scrollbox phosphor fw-gothic">
          <div id="story-text" class="story-block">
            <!-- JSでフェードイン表示（固定文／タイプライターなし） -->
          </div>
        </div>
        <button id="btn-to-warning" class="btn">過去の患者カルテを見る</button>
      </div>
    </div>

    <!-- “たすけて”ミニウィンドウ（遅れて表示） -->
    <div id="win-chant" class="browser retro crt win win-mini hidden">
      <div class="retro-titlebar">
        <span class="retro-title">受 信 ロ グ</span>
        <div class="retro-controls"><span class="ctrl">_</span><span class="ctrl">□</span><span class="ctrl close">×</span></div>
      </div>
      <div class="retro-pane">
        <div id="chant-scroll" class="scrollbox phosphor fw-gothic">
          <div id="chant-text" class="help-chant"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- 4) 注意 -->
<section id="screen-warning" class="screen">
  <div class="center">
    <p class="warning spaced warning-block">
      これから表示される内容は<br>
      極めて危険です。<br>
      閲覧によって発生したいかなる<br>
      事象についても当院は<br>
      責任を負いかねます。<br>
      自己責任で閲覧してください。
    </p>
    <p class="small-note red">※ 個人情報は伏せた上で、掲載許可を得た記録のみ表示しています。</p>
    <button id="btn-agree" class="btn">同意して閲覧</button>
  </div>
</section>

<!-- 5) カルテロード -->
<section id="screen-records-loading" class="screen">
  <div class="center">
    <p class="spaced">カルテ情報を取得しています…</p>
    <p id="rec-per" class="percent">0%</p>
  </div>
</section>

<!-- 6) カルテ一覧 -->
<section id="screen-records" class="screen page-scroll">
  <div class="records crt">
    <h3 class="records-title chromatic">患者記録一覧</h3>
    <div id="records-list"></div>
    <div class="controls"><button id="btn-back-story" class="btn">発祥ストーリーに戻る</button></div>
  </div>
</section>

<!-- 7) 詳細モーダル -->
<div id="modal" role="dialog" aria-hidden="true">
  <div class="modal-inner">
    <h4 id="modal-title" class="modal-title">患者記録</h4>
    <div id="modal-body" class="modal-body"></div>
    <div class="modal-actions"><button id="modal-close" class="btn">閉じる</button></div>
  </div>
</div>

<script src="script.js?v=80"></script>
</body>
</html>
